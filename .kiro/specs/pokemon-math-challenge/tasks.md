# 実装計画

- [x] 1. プロジェクトのセットアップと基本構成
  - Vite + React + TypeScript プロジェクトを作成
  - Tailwind CSS と shadcn/ui をセットアップ
  - Vitest と React Testing Library を設定
  - プロジェクトのディレクトリ構造を作成
  - _要件: 全体_

- [x] 2. 型定義とデータモデルの実装
  - [x] 2.1 TypeScript型定義ファイルを作成
    - `src/types/index.ts` に全ての型定義を実装
    - Difficulty, OperationType, Rarity, Pokemon, GridData, AnswerCellState, ChallengeSession, UserData, RewardType, Reward の型を定義
    - 100マス計算形式に対応した型定義（GridData, AnswerCellState）
    - _要件: 全体_

  - [x] 2.2 ポケモンレア度判定ユーティリティを作成
    - `src/utils/pokemonRarity.ts` にレア度判定ロジックを実装
    - PokeAPI の pokemon ID に基づいてレア度を判定
    - 伝説のポケモン、レアポケモン、コモンポケモンの分類
    - _要件: 5.4, 6.2_

- [x] 3. 計算問題生成サービスの実装（TDD）- 100マス計算形式
  - [x] 3.1 ProblemGenerator のテストを作成
    - グリッドデータ生成のテスト（ヘッダー行・列）
    - 簡単モード: 1桁の足し算・引き算のテスト
    - 普通モード: 1桁の掛け算のテスト
    - 難しいモード: 2桁の計算のテスト
    - 回答セル初期化のテスト（100個のセル生成）
    - 正解計算のテスト
    - _要件: 1.1, 1.2, 3.3, 3.4, 3.5_

  - [x] 3.2 ProblemGenerator サービスを実装
    - `src/services/ProblemGenerator.ts` を作成
    - generateGrid メソッドを実装（ヘッダー行・列の生成）
    - initializeAnswerCells メソッドを実装（回答セルの初期化）
    - calculateAnswer メソッドを実装（正解計算）
    - 各難易度に応じた問題生成ロジックを実装
    - _要件: 1.1, 1.2, 3.2, 3.3, 3.4, 3.5_

- [x] 4. LocalStorage サービスの実装（TDD）
  - [x] 4.1 StorageService のテストを作成
    - ユーザーデータの保存・読み込みのテスト
    - デフォルトデータの生成テスト
    - QuotaExceededError ハンドリングのテスト
    - _要件: 7.1, 7.2_

  - [x] 4.2 StorageService を実装
    - `src/services/StorageService.ts` を作成
    - LocalStorage の読み書き処理を実装
    - エラーハンドリングを実装
    - _要件: 7.1, 7.2_

- [x] 5. 報酬計算サービスの実装（TDD）
  - [x] 5.1 RewardCalculator のテストを作成
    - 初クリア報酬のテスト
    - 新記録報酬のテスト
    - ノーミス報酬のテスト
    - 完了報酬のテスト
    - 難易度別のポイント計算テスト
    - _要件: 4.1, 4.2, 4.3, 4.4_

  - [x] 5.2 RewardCalculator サービスを実装
    - `src/services/RewardCalculator.ts` を作成
    - 報酬計算ロジックを実装
    - 難易度別のポイント設定を実装
    - _要件: 4.1, 4.2, 4.3, 4.4_

- [x] 6. PokeAPI サービスの実装（TDD）
  - [x] 6.1 PokeApiService のテストを作成
    - ランダムポケモン取得のテスト
    - IDでポケモン取得のテスト
    - 複数ポケモン取得のテスト
    - レア度判定のテスト
    - エラーハンドリングのテスト（ネットワークエラー、タイムアウト）
    - _要件: 5.4, 6.2_

  - [x] 6.2 PokeApiService を実装
    - `src/services/PokeApiService.ts` を作成
    - PokeAPI との通信処理を実装
    - リトライロジックを実装
    - レア度判定ロジックを実装
    - _要件: 5.4, 6.2_

- [x] 7. ガチャサービスの実装（TDD）
  - [x] 7.1 GachaService のテストを作成
    - ポイント不足時のテスト
    - レア度別の確率テスト
    - PokeApiService との連携テスト
    - ポイント消費のテスト
    - _要件: 5.1, 5.2, 5.3, 5.4, 5.5_

  - [x] 7.2 GachaService を実装
    - `src/services/GachaService.ts` を作成
    - レア度選択ロジックを実装
    - PokeApiService を使用したポケモン取得を実装
    - _要件: 5.1, 5.2, 5.3, 5.4, 5.5_

- [x] 8. ユーザーデータ管理 Context の実装（TDD）
  - [x] 8.1 UserContext のテストを作成
    - ユーザーデータの初期化テスト
    - ポイント追加・消費のテスト
    - ポケモン追加のテスト（PokeAPI の ID を使用）
    - 統計更新のテスト
    - _要件: 5.6, 6.1, 7.1, 7.2, 7.4_

  - [x] 8.2 UserContext と Reducer を実装
    - `src/contexts/UserContext.tsx` を作成
    - ユーザーデータの状態管理を実装
    - StorageService との連携を実装
    - _要件: 5.6, 6.1, 7.1, 7.2, 7.4_

- [x] 9. ゲーム状態管理 Context の実装（TDD）
  - [x] 9.1 GameContext のテストを作成
    - セッション開始のテスト（PokeApiService からポケモン取得）
    - 回答検証のテスト
    - タイマー管理のテスト
    - セッション完了のテスト
    - _要件: 1.1, 1.2, 1.3, 2.1, 2.2, 2.3, 2.4_

  - [x] 9.2 GameContext と Reducer を実装
    - `src/contexts/GameContext.tsx` を作成
    - チャレンジセッションの状態管理を実装
    - ProblemGenerator と PokeApiService との連携を実装
    - _要件: 1.1, 1.2, 1.3, 2.1, 2.2, 2.3, 2.4_

- [x] 10. 難易度選択画面の実装（TDD）
  - [x] 10.1 DifficultySelector のテストを作成
    - 3つの難易度ボタンの表示テスト
    - 難易度選択時の動作テスト
    - ゲーム開始時のイベント発火テスト
    - ローディング状態の表示テスト（PokeAPI 通信中）
    - _要件: 3.1, 3.2_

  - [x] 10.2 DifficultySelector コンポーネントを実装
    - `src/components/DifficultySelector/DifficultySelector.tsx` を作成
    - shadcn/ui の Button コンポーネントを使用
    - 難易度選択UIを実装
    - PokeAPI 通信中のローディング表示を実装
    - _要件: 3.1, 3.2_

- [x] 11. タイマーコンポーネントの実装（TDD）
  - [x] 11.1 Timer のテストを作成
    - カウントダウン表示のテスト
    - 時間切れ時のイベント発火テスト
    - 残り時間が少ない時の警告表示テスト
    - 電卓UI表示中もタイマーが動作することのテスト
    - _要件: 2.1, 2.2, 2.4, 2.5_

  - [x] 11.2 Timer コンポーネントを実装
    - `src/components/Timer/Timer.tsx` を作成
    - カウントダウンロジックを実装
    - 視覚的な警告表示を実装
    - _要件: 2.1, 2.2, 2.4_

- [x] 12. ヘッダーセルコンポーネントの実装（TDD）
  - [x] 12.1 HeaderCell のテストを作成
    - 数字の表示テスト
    - 読み取り専用（タップ不可）のテスト
    - ヘッダー行・列の視覚的区別のテスト
    - _要件: 1.1_

  - [x] 12.2 HeaderCell コンポーネントを実装
    - `src/components/GameBoard/HeaderCell.tsx` を作成
    - 数字を表示する読み取り専用セル
    - ヘッダー用のスタイリングを実装
    - _要件: 1.1_

- [x] 13. 回答セルコンポーネントの実装（TDD）
  - [x] 13.1 AnswerCell のテストを作成
    - セルのタップ検知テスト
    - 未回答時の表示テスト
    - 正解時の表示テスト（入力した数字を表示）
    - 不正解時の表示テスト
    - 正解時のアニメーションテスト
    - _要件: 1.4, 1.5, 1.6_

  - [x] 13.2 AnswerCell コンポーネントを実装
    - `src/components/GameBoard/AnswerCell.tsx` を作成
    - タップ可能なセルを実装
    - 状態に応じた表示を実装
    - 正解/不正解のフィードバックを実装
    - アニメーション効果を実装
    - _要件: 1.4, 1.5, 1.6_

- [x] 14. 電卓UIコンポーネントの実装（TDD）
  - [x] 14.1 CalculatorModal のテストを作成
    - モーダル/ボトムシート表示のテスト
    - 数字ボタン（0-9）のテスト
    - 削除ボタンのテスト
    - 決定ボタンのテスト
    - ディスプレイエリアの表示テスト
    - 問題表示のテスト（ヘッダー行・列の数字と演算記号）
    - ボタンサイズのテスト（最低44x44px）
    - 外側タップで閉じるテスト
    - _要件: 8.1, 8.2, 8.3, 8.4, 8.5, 8.6, 8.7, 8.8, 8.9, 8.10_

  - [x] 14.2 CalculatorModal コンポーネントを実装
    - `src/components/GameBoard/CalculatorModal.tsx` を作成
    - shadcn/ui の Sheet コンポーネントを使用
    - 電卓風のUIを実装（3×4グリッド）
    - 数字入力ロジックを実装
    - 削除・決定ボタンを実装
    - タッチフレンドリーな大きなボタンを実装
    - _要件: 8.1, 8.2, 8.3, 8.4, 8.5, 8.6, 8.7, 8.8, 8.9, 8.10_

- [x] 15. 隠しポケモン画像コンポーネントの実装（TDD）
  - [x] 15.1 HiddenImage のテストを作成
    - 初期状態で画像が隠れているテスト
    - セルが開くと対応部分が表示されるテスト
    - 段階的に画像が見えるテスト
    - PokeAPI から取得した画像URLの表示テスト
    - _要件: 1.3, 1.7_

  - [x] 15.2 HiddenImage コンポーネントを実装
    - `src/components/GameBoard/HiddenImage.tsx` を作成
    - グリッドレイアウトで画像を分割表示
    - セルの状態に応じた表示制御を実装
    - PokeAPI の画像を使用
    - _要件: 1.3, 1.7_

- [x] 16. ゲームボードコンポーネントの実装（TDD）
  - [x] 16.1 GameBoard のテストを作成
    - 100マス計算形式のグリッド表示テスト（ヘッダー行・列 + 10×10回答セル）
    - HeaderCell コンポーネントとの統合テスト
    - AnswerCell コンポーネントとの統合テスト
    - CalculatorModal との統合テスト
    - HiddenImage コンポーネントとの統合テスト
    - セルタップ時の電卓UI表示テスト
    - ゲームフロー全体のテスト
    - _要件: 1.1, 1.2, 1.3, 1.4, 1.5, 1.6, 1.7_

  - [x] 16.2 GameBoard コンポーネントを実装
    - `src/components/GameBoard/GameBoard.tsx` を作成
    - 100マス計算形式のグリッドレイアウトを実装
    - ヘッダー行・列を配置
    - 10×10の回答セルを配置
    - HeaderCell, AnswerCell, CalculatorModal, HiddenImage を統合
    - GameContext との連携を実装
    - _要件: 1.1, 1.2, 1.3, 1.4, 1.5, 1.6, 1.7_

- [x] 17. 報酬表示モーダルの実装（TDD）
  - [x] 17.1 RewardModal のテストを作成
    - 報酬一覧の表示テスト
    - ポケモン獲得演出のテスト
    - ポイント表示のテスト
    - PokeAPI から取得したポケモン情報の表示テスト
    - _要件: 2.3, 4.1, 4.2, 4.3_

  - [x] 17.2 RewardModal コンポーネントを実装
    - `src/components/Rewards/RewardModal.tsx` を作成
    - shadcn/ui の Dialog コンポーネントを使用
    - 報酬表示UIを実装
    - アニメーション演出を実装
    - _要件: 2.3, 4.1, 4.2, 4.3_

- [x] 18. ガチャ画面の実装（TDD）
  - [x] 18.1 GachaView のテストを作成
    - ガチャボタンの表示テスト
    - ポイント不足時のエラー表示テスト
    - ガチャ実行時の動作テスト
    - ポケモン獲得演出のテスト
    - PokeAPI 通信エラー時のハンドリングテスト
    - _要件: 5.1, 5.2, 5.3, 5.5, 5.6_

  - [x] 18.2 GachaView コンポーネントを実装
    - `src/components/Gacha/GachaView.tsx` を作成
    - shadcn/ui の Button, Card コンポーネントを使用
    - GachaService との連携を実装
    - ガチャアニメーションを実装
    - エラーハンドリングを実装
    - _要件: 5.1, 5.2, 5.3, 5.5, 5.6_

- [x] 19. コレクション画面の実装（TDD）
  - [x] 19.1 PokemonCard のテストを作成
    - ポケモン情報の表示テスト
    - 未獲得ポケモンのシルエット表示テスト
    - レア度表示のテスト
    - PokeAPI から取得した画像の表示テスト
    - _要件: 6.2, 6.3_

  - [x] 19.2 PokemonCard コンポーネントを実装
    - `src/components/Collection/PokemonCard.tsx` を作成
    - shadcn/ui の Card コンポーネントを使用
    - ポケモン情報の表示を実装
    - _要件: 6.2, 6.3_

  - [x] 19.3 CollectionView のテストを作成
    - コレクション一覧の表示テスト
    - 完成度表示のテスト
    - レア度フィルタリングのテスト
    - PokeApiService を使用した複数ポケモン取得のテスト
    - _要件: 6.1, 6.2, 6.3, 6.4_

  - [x] 19.4 CollectionView コンポーネントを実装
    - `src/components/Collection/CollectionView.tsx` を作成
    - PokemonCard を使用してグリッド表示
    - フィルタリング機能を実装
    - 完成度表示を実装
    - PokeApiService との連携を実装
    - _要件: 6.1, 6.2, 6.3, 6.4_

- [x] 20. 統計画面の実装（TDD）
  - [x] 20.1 StatsView のテストを作成
    - 最速記録の表示テスト
    - 総プレイ回数の表示テスト
    - 獲得ポイント数の表示テスト
    - 難易度別の統計表示テスト
    - _要件: 7.1, 7.2, 7.3, 7.4_

  - [x] 20.2 StatsView コンポーネントを実装
    - `src/components/Stats/StatsView.tsx` を作成
    - shadcn/ui の Card, Table コンポーネントを使用
    - 統計情報の表示を実装
    - _要件: 7.1, 7.2, 7.3, 7.4_

- [x] 21. メインアプリケーションの統合
  - [x] 21.1 App コンポーネントのテストを作成
    - ルーティングのテスト
    - Context Provider の統合テスト
    - 画面遷移のテスト
    - _要件: 全体_

  - [x] 21.2 App コンポーネントを実装
    - `src/App.tsx` を作成
    - UserContext と GameContext を Provider として配置
    - ナビゲーションを実装
    - 各画面コンポーネントを統合
    - _要件: 全体_

- [x] 22. エラーハンドリングの実装
  - [x] 22.1 ErrorBoundary のテストを作成
    - エラーキャッチのテスト
    - エラー画面表示のテスト
    - PokeAPI エラー時の表示テスト
    - _要件: 全体_

  - [x] 22.2 ErrorBoundary コンポーネントを実装
    - `src/components/ErrorBoundary.tsx` を作成
    - エラーハンドリングロジックを実装
    - ユーザーフレンドリーなエラー画面を実装
    - _要件: 全体_

- [x] 23. E2Eシナリオテストの作成
  - 難易度選択からゲームプレイ、報酬獲得までの完全なフローをテスト
  - 電卓UIを使用した回答入力のテスト
  - ガチャ実行からコレクション確認までのフローをテスト
  - データ永続化の確認テスト
  - PokeAPI との統合テスト
  - _要件: 全体_

- [x] 24. UI/UXの最終調整
  - 子供向けの大きなタッチターゲットを確認（特に電卓UIのボタン）
  - アニメーション効果の調整
  - カラースキームの調整
  - レスポンシブデザインの確認（スマホ・タブレット対応）
  - 電卓UIの使いやすさを確認
  - 100マス計算グリッドの視認性を確認
  - PokeAPI 通信中のローディング表示の最適化
  - _要件: 全体_
  - 子供向けの大きなタッチターゲットを確認
  - アニメーション効果の調整
  - カラースキームの調整
  - レスポンシブデザインの確認
  - PokeAPI 通信中のローディング表示の最適化
  - _要件: 全体_

## 追加タスク（オプション）

- [ ] 23. TypeScriptビルドエラーの修正
  - テストファイルのTypeScriptエラーを修正
  - 未使用のimportを削除
  - global型定義の問題を解決
  - _要件: 全体_

- [ ] 24. パフォーマンス最適化
  - React.memoを使用してコンポーネントの再レンダリングを最適化
  - useMemoとuseCallbackで計算とコールバックをメモ化
  - 画像の遅延読み込みを実装
  - _要件: 全体_

- [ ] 25. アクセシビリティの向上
  - ARIA属性の追加と改善
  - キーボードナビゲーションの強化
  - スクリーンリーダー対応の改善
  - _要件: 全体_

- [ ] 26. エラーメッセージの多言語対応
  - エラーメッセージを日本語で統一
  - ユーザーフレンドリーなエラー表示の改善
  - _要件: 全体_
